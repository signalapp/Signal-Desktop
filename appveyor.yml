platform:
  - x64

cache:
  - '%LOCALAPPDATA%\electron\Cache'
  - node_modules -> package.json

install:
  - systeminfo | findstr /C:"OS"
  - set PATH=C:\Ruby23-x64\bin;%PATH%
  - ps: Install-Product node 6 x64
  - yarn install
  - type node_modules\.bin\grunt.cmd

build_script:
  - yarn run icon-gen
  - del /f images\emoji\apple
  - mkdir images\emoji\apple
  - xcopy /Q components\emojidata\img-apple-64 images\emoji\apple
  - node_modules\.bin\grunt
  - node_modules\.bin\build --em.environment=%SIGNAL_ENV% --publish=never

test_script:
  - node_modules\.bin\grunt test-release:win
  - node_modules\.bin\grunt test

artifacts:
  - path: dist/*.*

environment:
  SIGNAL_ENV: production

deploy:
  provider: Environment
  name: signal-desktop-builds
